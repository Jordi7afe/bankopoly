<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bankopoly - Gestión Épica de Dinero</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <link rel="manifest" href="data:application/manifest+json,{'name':'Bankopoly','short_name':'Bankopoly','start_url':'.','display':'standalone','background_color':'#0f172a','theme_color':'#0f172a'}">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');

        :root {
            --gold: #fbbf24;
            --luxury-dark: #0f172a;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--luxury-dark);
            color: white;
            overflow-x: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .player-card {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.2s;
            touch-action: none;
        }

        .player-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
            z-index: 50;
        }

        .drop-target {
            border: 2px dashed var(--gold) !important;
            transform: scale(1.05);
        }

        .gold-gradient {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        }

        .money-text {
            font-variant-numeric: tabular-nums;
        }

        #drag-proxy {
            position: fixed;
            pointer-events: none;
            display: none;
            z-index: 9999;
            opacity: 0.8;
            transform: translate(-50%, -50%);
        }

        .animate-in {
            animation: fadeInScale 0.3s ease-out forwards;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen pb-24">

    <!-- Header -->
    <header class="p-6 flex justify-between items-center sticky top-0 z-40 glass mb-4">
        <div class="flex items-center gap-3">
            <button onclick="toggleLanguage()" class="w-8 h-8 rounded-lg glass flex items-center justify-center text-[10px] font-bold border-yellow-500/30 text-yellow-500">
                <span id="lang-indicator">ES</span>
            </button>
            <div>
                <h1 class="text-2xl font-800 tracking-tighter text-yellow-500 italic">BANKOPOLY</h1>
                <p id="header-subtitle" class="text-xs text-slate-400 font-medium uppercase tracking-tighter"></p>
            </div>
        </div>
        <button onclick="toggleAddModal(true)" class="w-10 h-10 rounded-full gold-gradient flex items-center justify-center shadow-lg shadow-yellow-500/20 active:scale-90 transition-transform">
            <i data-lucide="plus" class="text-slate-900 w-6 h-6"></i>
        </button>
    </header>

    <main id="app" class="px-4 space-y-4">
        <!-- Content generated by JS -->
    </main>

    <!-- Transaction Modal -->
    <div id="payment-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closePaymentModal()"></div>
        <div class="glass w-full max-w-md rounded-3xl p-6 relative animate-in space-y-6">
            <div class="text-center">
                <div class="flex items-center justify-center gap-4 mb-4">
                    <div id="payer-icon" class="w-12 h-12 rounded-full flex items-center justify-center bg-red-500/20 border border-red-500/50">
                        <i data-lucide="arrow-up-right" class="text-red-500"></i>
                    </div>
                    <i data-lucide="chevron-right" class="text-slate-500"></i>
                    <div id="receiver-icon" class="w-12 h-12 rounded-full flex items-center justify-center bg-green-500/20 border border-green-500/50">
                        <i data-lucide="arrow-down-left" class="text-green-500"></i>
                    </div>
                </div>
                <h3 id="payment-desc" class="text-xl font-bold"></h3>
            </div>

            <div class="space-y-4">
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-2xl font-bold text-yellow-500">$</span>
                    <input type="number" id="payment-amount" value="200" class="w-full bg-slate-800/50 border border-slate-700 rounded-2xl py-4 pl-10 pr-4 text-3xl font-bold text-center focus:outline-none focus:border-yellow-500 transition-colors">
                </div>

                <div class="grid grid-cols-4 gap-2">
                    <button onclick="setAmount(10)" class="py-2 rounded-xl glass text-sm font-semibold hover:bg-slate-700">10</button>
                    <button onclick="setAmount(50)" class="py-2 rounded-xl glass text-sm font-semibold hover:bg-slate-700">50</button>
                    <button onclick="setAmount(100)" class="py-2 rounded-xl glass text-sm font-semibold hover:bg-slate-700">100</button>
                    <button onclick="setAmount(200)" class="py-2 rounded-xl glass text-sm font-semibold hover:bg-slate-700">200</button>
                </div>

                <div class="px-2">
                    <input type="range" id="amount-slider" min="0" max="2000" step="10" value="200" class="w-full accent-yellow-500 h-2 rounded-lg cursor-pointer" oninput="syncAmount(this.value)">
                </div>

                <div class="flex gap-3 pt-2">
                    <button id="btn-cancel" onclick="closePaymentModal()" class="flex-1 py-4 rounded-2xl bg-slate-800 font-bold text-slate-300 hover:bg-slate-700 active:scale-95 transition-all uppercase"></button>
                    <button id="btn-confirm" onclick="confirmTransaction()" class="flex-1 py-4 rounded-2xl gold-gradient font-bold text-slate-900 shadow-lg shadow-yellow-500/20 active:scale-95 transition-all uppercase"></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Player Modal -->
    <div id="add-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="toggleAddModal(false)"></div>
        <div class="glass w-full max-w-sm rounded-3xl p-6 relative animate-in space-y-4">
            <h3 id="add-player-title" class="text-xl font-bold text-center"></h3>
            <input type="text" id="player-name-input" class="w-full bg-slate-800/50 border border-slate-700 rounded-2xl p-4 focus:outline-none focus:border-yellow-500">
            <button id="btn-join" onclick="addPlayer()" class="w-full py-4 rounded-2xl gold-gradient font-bold text-slate-900 active:scale-95 transition-all uppercase"></button>
        </div>
    </div>

    <!-- Drag Proxy -->
    <div id="drag-proxy" class="w-24 h-24 rounded-2xl gold-gradient flex flex-col items-center justify-center text-slate-900 shadow-2xl">
        <i data-lucide="user" class="w-8 h-8"></i>
        <span id="proxy-text" class="text-xs font-bold uppercase mt-1"></span>
    </div>

    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 glass px-6 py-3 rounded-full opacity-0 pointer-events-none transition-all duration-300 translate-y-10 z-[100] border-yellow-500/30">
        <span id="toast-message" class="text-sm font-semibold"></span>
    </div>

    <script>
        const i18n = {
            es: {
                subtitle: 'Centro de Control Financiero',
                bank: 'BANCA',
                reserve: 'FONDO FEDERAL',
                payPlayer: 'Pagar a Jugador',
                cancel: 'Cancelar',
                confirm: 'Confirmar',
                addPlayer: 'Añadir Jugador',
                playerNamePlaceholder: 'Nombre del jugador...',
                joinGame: 'Unirse al Juego',
                moving: 'Moviendo',
                insufficient: '¡Fondos insuficientes!',
                transferOk: 'Transferencia realizada',
                joined: 'se ha unido',
                deleteConfirm: '¿Eliminar jugador?',
                resetConfirm: '¿Reiniciar partida? Se borrarán todos los jugadores.',
                restart: 'Reiniciar Partida'
            },
            en: {
                subtitle: 'Financial Control Center',
                bank: 'BANK',
                reserve: 'FEDERAL RESERVE',
                payPlayer: 'Pay Player',
                cancel: 'Cancel',
                confirm: 'Confirm',
                addPlayer: 'Add Player',
                playerNamePlaceholder: 'Player name...',
                joinGame: 'Join the Game',
                moving: 'Moving',
                insufficient: 'Insufficient funds!',
                transferOk: 'Transfer completed',
                joined: 'has joined',
                deleteConfirm: 'Delete player?',
                resetConfirm: 'Restart game? All players will be removed.',
                restart: 'Restart Game'
            }
        };

        let state = {
            lang: 'es',
            players: [],
            bank: { id: 'bank', name: 'BANCA', money: 1000000 },
            initialMoney: 1500
        };

        let activeTransaction = { from: null, to: null };

        function saveState() {
            localStorage.setItem('bankopoly_state_v2', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('bankopoly_state_v2');
            if (saved) {
                state = JSON.parse(saved);
            }
        }

        function toggleLanguage() {
            state.lang = state.lang === 'es' ? 'en' : 'es';
            state.bank.name = i18n[state.lang].bank;
            saveState();
            render();
            showToast(state.lang === 'es' ? 'Idioma: Español' : 'Language: English');
        }

        function addPlayer() {
            const input = document.getElementById('player-name-input');
            const name = input.value.trim();
            if (!name) return;

            const newPlayer = {
                id: 'p' + Date.now(),
                name: name.toUpperCase(),
                money: state.initialMoney,
                color: `hsl(${Math.random() * 360}, 70%, 60%)`
            };

            state.players.push(newPlayer);
            saveState();
            render();
            toggleAddModal(false);
            input.value = '';
            showToast(`${name} ${i18n[state.lang].joined}`);
        }

        function removePlayer(id) {
            if (confirm(i18n[state.lang].deleteConfirm)) {
                state.players = state.players.filter(p => p.id !== id);
                saveState();
                render();
            }
        }

        function resetGame() {
            if (confirm(i18n[state.lang].resetConfirm)) {
                localStorage.removeItem('bankopoly_state_v2');
                location.reload();
            }
        }

        function render() {
            const t = i18n[state.lang];
            
            // Text updates
            document.getElementById('lang-indicator').innerText = state.lang.toUpperCase();
            document.getElementById('header-subtitle').innerText = t.subtitle;
            document.getElementById('btn-cancel').innerText = t.cancel;
            document.getElementById('btn-confirm').innerText = t.confirm;
            document.getElementById('add-player-title').innerText = t.addPlayer;
            document.getElementById('player-name-input').placeholder = t.playerNamePlaceholder;
            document.getElementById('btn-join').innerText = t.joinGame;
            document.getElementById('proxy-text').innerText = t.moving;

            const app = document.getElementById('app');
            app.innerHTML = '';

            const bankHtml = createPlayerCard(state.bank, true);
            app.appendChild(bankHtml);

            const playersList = document.createElement('div');
            playersList.className = 'grid grid-cols-2 gap-4';
            state.players.forEach(p => {
                playersList.appendChild(createPlayerCard(p, false));
            });
            app.appendChild(playersList);

            if (state.players.length > 0) {
                const footer = document.createElement('div');
                footer.className = 'flex justify-center pt-8';
                footer.innerHTML = `
                    <button onclick="resetGame()" class="text-xs text-slate-500 font-bold uppercase tracking-widest border border-slate-700 px-4 py-2 rounded-full">
                        ${t.restart}
                    </button>
                `;
                app.appendChild(footer);
            }

            lucide.createIcons();
            setupDragEvents();
        }

        function createPlayerCard(p, isBank) {
            const t = i18n[state.lang];
            const div = document.createElement('div');
            div.id = p.id;
            div.className = `player-card p-4 rounded-3xl glass relative ${isBank ? 'w-full mb-6 border-yellow-500/20' : 'aspect-square flex flex-col justify-between'}`;
            div.setAttribute('draggable', 'true');
            div.dataset.id = p.id;

            const initials = p.name.substring(0, 2);
            
            if (isBank) {
                div.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl gold-gradient flex items-center justify-center text-slate-900 shadow-xl shadow-yellow-500/20">
                                <i data-lucide="landmark" class="w-8 h-8"></i>
                            </div>
                            <div>
                                <span class="text-xs font-bold text-yellow-500 tracking-widest">${t.reserve}</span>
                                <h2 class="text-2xl font-black">${p.name}</h2>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-3xl font-black money-text text-yellow-500">$${p.money.toLocaleString()}</p>
                        </div>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-lg" style="background-color: ${p.color}">
                            ${initials}
                        </div>
                        <button onclick="removePlayer('${p.id}')" class="text-slate-600 hover:text-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>
                    <div class="mt-4">
                        <h2 class="text-sm font-bold text-slate-400 uppercase truncate">${p.name}</h2>
                        <p class="text-2xl font-black money-text tracking-tighter">$${p.money.toLocaleString()}</p>
                    </div>
                `;
            }
            return div;
        }

        function toggleAddModal(show) {
            document.getElementById('add-modal').classList.toggle('hidden', !show);
            if (show) document.getElementById('player-name-input').focus();
        }

        function openPaymentModal(from, to) {
            if (from === to) return;
            activeTransaction = { from, to };
            
            const fromObj = from === 'bank' ? state.bank : state.players.find(p => p.id === from);
            const toObj = to === 'bank' ? state.bank : state.players.find(p => p.id === to);

            document.getElementById('payment-desc').innerText = `${fromObj.name} → ${toObj.name}`;
            document.getElementById('payment-amount').value = 200;
            document.getElementById('amount-slider').value = 200;
            document.getElementById('payment-modal').classList.remove('hidden');
        }

        function closePaymentModal() {
            document.getElementById('payment-modal').classList.add('hidden');
        }

        function setAmount(val) {
            document.getElementById('payment-amount').value = val;
            document.getElementById('amount-slider').value = val;
        }

        function syncAmount(val) {
            document.getElementById('payment-amount').value = val;
        }

        function confirmTransaction() {
            const amount = parseInt(document.getElementById('payment-amount').value);
            const { from, to } = activeTransaction;
            const t = i18n[state.lang];

            if (isNaN(amount) || amount <= 0) return;

            let fromObj = from === 'bank' ? state.bank : state.players.find(p => p.id === from);
            let toObj = to === 'bank' ? state.bank : state.players.find(p => p.id === to);

            if (fromObj.id !== 'bank' && fromObj.money < amount) {
                showToast(t.insufficient);
                return;
            }

            fromObj.money -= amount;
            toObj.money += amount;

            saveState();
            render();
            closePaymentModal();
            showToast(`${t.transferOk}: $${amount}`);
        }

        let dragSourceId = null;
        function setupDragEvents() {
            const cards = document.querySelectorAll('.player-card');
            const proxy = document.getElementById('drag-proxy');

            cards.forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    dragSourceId = card.dataset.id;
                    card.classList.add('dragging');
                });

                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    document.querySelectorAll('.player-card').forEach(c => c.classList.remove('drop-target'));
                });

                card.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    card.classList.add('drop-target');
                });

                card.addEventListener('dragleave', () => card.classList.remove('drop-target'));

                card.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (dragSourceId && card.dataset.id) openPaymentModal(dragSourceId, card.dataset.id);
                });

                // Touch support
                card.addEventListener('touchstart', (e) => {
                    const touch = e.touches[0];
                    dragSourceId = card.dataset.id;
                    setTimeout(() => {
                        if (dragSourceId) {
                            proxy.style.display = 'flex';
                            proxy.style.left = touch.clientX + 'px';
                            proxy.style.top = touch.clientY + 'px';
                        }
                    }, 100);
                }, { passive: true });
            });

            window.addEventListener('touchmove', (e) => {
                if (!dragSourceId) return;
                const touch = e.touches[0];
                proxy.style.left = touch.clientX + 'px';
                proxy.style.top = touch.clientY + 'px';
                const el = document.elementFromPoint(touch.clientX, touch.clientY);
                const targetCard = el?.closest('.player-card');
                document.querySelectorAll('.player-card').forEach(c => c.classList.remove('drop-target'));
                if (targetCard && targetCard.id !== dragSourceId) targetCard.classList.add('drop-target');
            });

            window.addEventListener('touchend', (e) => {
                if (!dragSourceId) return;
                proxy.style.display = 'none';
                const touch = e.changedTouches[0];
                const el = document.elementFromPoint(touch.clientX, touch.clientY);
                const targetCard = el?.closest('.player-card');
                if (targetCard && targetCard.id !== dragSourceId) openPaymentModal(dragSourceId, targetCard.id);
                dragSourceId = null;
                document.querySelectorAll('.player-card').forEach(c => c.classList.remove('drop-target'));
            });
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').innerText = msg;
            toast.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
            }, 3000);
        }

        window.onload = () => {
            loadState();
            render();
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi.h...').catch(() => {});
            }
        };
    </script>
</body>
</html>
